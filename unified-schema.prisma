generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- AUTH SERVICE ---
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  isVerified    Boolean   @default(false) @map("is_verified")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  
  refreshTokens RefreshToken[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

// --- USER SERVICE ---
model UserProfile {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  firstName       String?  @map("first_name")
  lastName        String?  @map("last_name")
  email           String   @unique
  dateOfBirth     DateTime? @map("date_of_birth")
  educationLevel  String?  @map("education_level")
  currentRole     String?  @map("current_role")
  location        String?
  experienceYears Int?     @map("experience_years")
  bio             String?
  role            String   @default("USER")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  skills      Skill[]
  interests   Interest[]
  assessments AssessmentResult[]

  @@map("user_profiles")
}

model Skill {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  skillName   String   @map("skill_name")
  proficiency String?
  yearsExp    Int?     @map("years_exp")
  createdAt   DateTime @default(now()) @map("created_at")

  userProfile UserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("skills")
}

model Interest {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  interestName String   @map("interest_name")
  priority     Int?
  createdAt    DateTime @default(now()) @map("created_at")

  userProfile UserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("interests")
}

model AssessmentResult {
  id             String   @id @default(uuid())
  userId         String   @map("user_id")
  assessmentType String   @map("assessment_type")
  score          Decimal
  details        String?
  completedAt    DateTime @map("completed_at")
  createdAt      DateTime @default(now()) @map("created_at")

  userProfile UserProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("assessment_results")
}

// --- CAREER SERVICE ---
model CareerPath {
  id              String   @id @default(uuid())
  title           String
  description     String?
  category        String?
  avgSalary       Decimal? @map("avg_salary")
  growthRate      Decimal? @map("growth_rate")
  difficulty      String?
  matchScore      Int?     @default(0) @map("match_score")
  salary          String?
  growth          String?
  demand          String?
  requiredSkills  String?  @map("required_skills")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  roadmaps        Roadmap[]

  @@map("career_paths")
}

model Roadmap {
  id              String        @id @default(uuid())
  careerPathId    String        @map("career_path_id")
  careerPath      CareerPath    @relation(fields: [careerPathId], references: [id])
  title           String
  description     String?
  items           RoadmapItem[]
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("roadmaps")
}

model RoadmapItem {
  id          String   @id @default(uuid())
  roadmapId   String   @map("roadmap_id")
  roadmap     Roadmap  @relation(fields: [roadmapId], references: [id])
  title       String
  description String?
  status      String   @default("locked")
  duration    String?
  order       Int
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("roadmap_items")
}

// --- AI SERVICE ---
model AiInteraction {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  interactionType String?  @map("interaction_type")
  prompt          String?
  response        String?
  metadata        String?
  createdAt       DateTime @default(now()) @map("created_at")

  @@map("ai_interactions")
}
